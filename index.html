<!DOCTYPE html>
<html>
  <head>
    <title>CARTO Map Projections v1</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <link rel="shortcut icon" href="http://cartodb.com/assets/favicon.ico" />
    
    <style>
      html, body, #map {
        height: 100%;
        padding: 0;
        margin: 0;
        font-family: "Open Sans";
      }
      
      #selector_menu{
        position: absolute;
        top: 20px;
        left: 80px;
        z-index: 9000;
        width: 498px;
        font-family: "Open Sans";
      }

      #infobox{
        position: absolute;
        top: 75px;
        right: 70px;
        width: 250px;
        height: auto;
        opacity: 0.9;
        padding: 5px 10px 5px 10px;
        background-color: white;
      }

    </style>

    <link rel="stylesheet" href="https://cartodb-libs.global.ssl.fastly.net/cartodb.js/v3/3.15/themes/css/cartodb.css" />

  </head>
  <body>

    <!-- map div -->
    <div id="map"></div>

    <!-- map projection selector -->
    <div id='selector_menu'>
      <select id='selector'>
        <option value="select_proj" selected>Select Map Projection</option>
      </select>
    </div>

    <!-- infobox -->
    <div id ="infobox">
      <div class="infobox-header">
        <h2 id="geogcs">Map Projection</h2>
        <br>
        <a id="image"></a>
      </div>
      <div class="infobox-content">
        <h3>Datum</h3>
        <p id="datum">Datum</p>
        <h3>Spheroid</h3>
        <p id="spheroid">Spheroid</p>
        <h3>Prime Meridian</h3>
        <p id="primem">Prime Meridian</p>
        <h3>Unit</h3>
        <p id="unit">Unit</p>
        <h3>Creator</h3>
        <p id="creator">Creator</p>
        <h3>Year</h3>
        <p id="year">Year</p>
        <h3>Type</h3>
        <p id="type">Type</p>
        <h3>Properties</h3>
        <p id="properties">Properties</p>
        <br>
        <p id="notes">Notes</p>
      </div>
    </div>

    <script src="https://cartodb-libs.global.ssl.fastly.net/cartodb.js/v3/3.15/cartodb.js"></script> 
    
    <!-- Drop your code between the script tags below! -->
    <script>

      function main() {

        var mapUrl='https://team.carto.com/u/ramirocartodb/api/v2/viz/b1807f06-88be-11e6-9f46-0e05a8b3e3d7/viz.json';

        cartodb.createVis('map', mapUrl)
        .on('done', function(vis,layers) {

          var land = layers[1].getSubLayer(0);

          var sql = new cartodb.SQL({ user: 'ramirocartodb' });

          sql.execute("SELECT * FROM ramirocartodb.map_projs ORDER BY auth_srid")
            .done(function(data) {

              for (var i = 0; i < data.total_rows; i++) {

                let j = i;

                // create map projection selector
                var srid = data.rows[j].auth_srid;
                var geogcs = data.rows[j].geogcs;

                // apend map projections
                $('#selector').append("<option value=" + srid + ">" + srid + " - " + geogcs + "</option>");

              }

            });

          $(document).on('change', '#selector', function(){

            // get srid selected
            var input = $( "#selector option:selected" ).text();
            var srid = input.split(' ')[0];

            // change visualization
            land.setSQL("SELECT cartodb_id, st_transform(the_geom, " + srid + ") as the_geom_webmercator" + " FROM ramirocartodb.ne_50m_land");
            
            sql.execute("SELECT * FROM ramirocartodb.map_projs WHERE auth_srid =" + srid)
            .done(function(data) {

              // get map projections attributes
              var geogcs = data.rows[0].geogcs;
              var datum = data.rows[0].datum;
              var primem = data.rows[0].primem;
              var unit = data.rows[0].unit;
              var creator = data.rows[0].creator;
              var year = data.rows[0].year;
              var type = data.rows[0].type;
              var properties = data.rows[0].properties;
              var notes = data.rows[0].notes;

              // get infobox elements and set attributes
              $('#geogcs').text(geogcs);
              $('#datum').text(datum);
              $('#primem').text(primem);
              $('#unit').text(unit);
              $('#creator').text(creator);
              $('#year').text(year);
              $('#type').text(type);
              $('#properties').text(properties);
              $('#notes').text(notes);

            });

          });

        });

      }

      window.onload = main; 
    
    </script>

  </body>
</html>