<!DOCTYPE html>
<html>
  <head>
    <title>CARTO Map Projections v1</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <link rel="shortcut icon" href="http://cartodb.com/assets/favicon.ico" />
    
    <style>
      html, body, #map {
        height: 100%;
        padding: 0;
        margin: 0;
        font-family: "Open Sans";
      }
      
      #selector_menu{
        z-index: 9000;
      }

      #infobox{
        position: absolute;
        font-size: 10px;
        top: 100px;
        left: 20px;
        width: 450px;
        height: auto;
        opacity: 0.9;
        padding: 5px 10px 5px 10px;
        background-color: white;
      }

    </style>

    <link rel="stylesheet" href="https://cartodb-libs.global.ssl.fastly.net/cartodb.js/v3/3.15/themes/css/cartodb.css" />

  </head>
  <body>

    <!-- map div -->
    <div id="map"></div>



    <!-- infobox -->
    <div id ="infobox">

      <!-- map projection selector -->
      <div id='selector_menu'>
        <select id='selector'>
          <option value="4326" selected>Select Map Projection</option>
        </select>
      </div>

      <div class="infobox-header">
        <h2 id="geogcs">WGS 84 / Pseudo-Mercator</h2>
      </div>
      <div class="infobox-content">
        <h3>Datum</h3>
        <p id="datum">WGS 1984</p>
        <h3>Spheroid</h3>
        <p id="spheroid">Spheroid</p>
        <h3>Prime Meridian</h3>
        <p id="primem">Greenwich</p>
        <h3>Unit</h3>
        <p id="unit">Meter</p>
        <h3>Creator</h3>
        <p id="creator">Google</p>
        <h3>Year</h3>
        <p id="year">2005</p>
        <h3>Type</h3>
        <p id="type">Cylindrical</p>
        <h3>Properties</h3>
        <p id="properties">Equidistant</p>
        <h3>Notes</h3>
        <p id="notes">A variation of the Mercator projection, ignoring the ellipticity of Earth for faster computation. The de facto standard for web mapping applications, used by Google Maps, Bing Maps, Mapquest, Mapbox, OpenStreetMap and others.</p>
      </div>
    </div>

    <script src="https://cartodb-libs.global.ssl.fastly.net/cartodb.js/v3/3.15/cartodb.js"></script> 
    
    <script>

      function main() {

        var mapUrl='https://team.carto.com/u/ramirocartodb/api/v2/viz/b1807f06-88be-11e6-9f46-0e05a8b3e3d7/viz.json';

        cartodb.createVis('map', mapUrl)
        .on('done', function(vis,layers) {

          var land = layers[1].getSubLayer(0);

          var sql = new cartodb.SQL({ user: 'ramirocartodb' });

          sql.execute("SELECT * FROM ramirocartodb.map_projs ORDER BY auth_srid")
            .done(function(data) {

              for (var i = 0; i < data.total_rows; i++) {

                let j = i;

                // create map projection selector
                var srid = data.rows[j].auth_srid;
                var geogcs = data.rows[j].geogcs;

                // apend map projections
                $('#selector').append("<option value=" + srid + ">" + srid + " - " + geogcs + "</option>");

              }

            });

          $(document).on('change', '#selector', function(){

            // get srid selected
            var input = $( "#selector option:selected" ).text();
            var srid = input.split(' ')[0];

            // change visualization
            land.setSQL("SELECT cartodb_id, st_transform(the_geom, " + srid + ") as the_geom_webmercator" + " FROM ramirocartodb.ne_50m_land");
            
            sql.execute("SELECT * FROM ramirocartodb.map_projs WHERE auth_srid =" + srid)
            .done(function(data) {

              // get map projections attributes
              var geogcs = data.rows[0].geogcs;
              var datum = data.rows[0].datum;
              var primem = data.rows[0].primem;
              var unit = data.rows[0].unit;
              var creator = data.rows[0].creator;
              var year = data.rows[0].year;
              var type = data.rows[0].type;
              var properties = data.rows[0].properties;
              var notes = data.rows[0].notes;

              // get infobox elements and set attributes
              $('#geogcs').text(geogcs);
              $('#datum').text(datum);
              $('#primem').text(primem);
              $('#unit').text(unit);
              $('#creator').text(creator);
              $('#year').text(year);
              $('#type').text(type);
              $('#properties').text(properties);
              $('#notes').text(notes);

            });

          });

        });

      }

      window.onload = main; 
    
    </script>

  </body>
</html>